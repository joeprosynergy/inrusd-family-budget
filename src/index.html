<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta name="description" content="InRUSD Family Budget Management App - Track expenses, manage budgets, and monitor family finances">
  
  <!-- Performance optimizations -->
  <link rel="preload" href="/assets/tailwind.css" as="style">
  <link rel="preconnect" href="https://firebase.googleapis.com">
  <link rel="dns-prefetch" href="https://firebaseapp.com">
  
  <!-- Critical CSS -->
  <style>
    /* Critical above-the-fold styles */
    body { font-family: sans-serif; margin: 0; background-color: #f3f4f6; }
    .loading-spinner { display: flex; justify-content: center; align-items: center; height: 100vh; }
    .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .hidden { display: none !important; }
  </style>
  
  <title>InRUSD: Family Budget</title>
  <link href="/assets/tailwind.css" rel="stylesheet">
  
  <!-- Optimized script loading -->
  <script defer>
    // Minimal inline script for error handling
    window.addEventListener('error', (event) => {
      console.error('Global error:', event.message);
    });
    
    window.addEventListener('load', () => {
      if (!window.initApp) {
        console.error('App failed to load');
        document.body.innerHTML += '<p style="color: red; text-align: center;">Error: App failed to load. Please refresh.</p>';
      }
    });
  </script>
  <script type="module" src="/js" defer></script>
</head>
<body class="bg-gray-100 font-sans">
<!-- Loading Spinner -->
<div id="loading-spinner" class="loading-spinner">
  <div style="animation: spin 1s linear infinite; width: 64px; height: 64px; border: 4px solid #f3f4f6; border-top: 4px solid #2563eb; border-radius: 50%;"></div>
</div>

<!-- Auth Section -->
<div id="auth-section" class="hidden auth-container">
  <div id="login-modal" class="bg-white p-6 sm:p-8 rounded-lg shadow-lg w-full max-w-sm sm:max-w-md" role="dialog" aria-modal="true" aria-label="Login Modal">
    <h2 class="text-xl sm:text-2xl font-bold mb-6 text-center text-gray-800">Login</h2>
    <form class="space-y-4">
      <div>
        <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
        <input id="login-email" type="email" placeholder="Email" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
      </div>
      <div>
        <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
        <input id="login-password" type="password" placeholder="Password" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
      </div>
      <button id="login-button" type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition">Login</button>
      <div class="text-center space-x-4">
        <button id="show-signup-btn" type="button" class="text-blue-600 hover:underline">Sign Up</button>
        <button id="show-reset-btn" type="button" class="text-blue-600 hover:underline">Forgot Password?</button>
      </div>
    </form>
  </div>
  
  <!-- Signup and Reset modals minimized for performance -->
  <div id="signup-modal" class="hidden bg-white p-6 sm:p-8 rounded-lg shadow-lg w-full max-w-sm sm:max-w-md"></div>
  <div id="reset-modal" class="hidden bg-white p-6 sm:p-8 rounded-lg shadow-lg w-full max-w-sm sm:max-w-md"></div>
</div>

<!-- App Section - Lazy loaded content containers -->
<div id="app-section" class="hidden min-h-screen bg-gray-100">
  <!-- Header -->
  <header class="bg-blue-600 text-white p-3 sm:p-4 flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-0">
    <h1 id="page-title" class="text-xl sm:text-2xl font-bold">Budget Dashboard</h1>
    <div class="flex items-center gap-2 sm:gap-4">
      <select id="currency-toggle" class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 bg-white text-gray-700 text-sm">
        <option value="INR">INR</option>
        <option value="USD">USD</option>
        <option value="ZAR">ZAR</option>
      </select>
      <button id="logout-button" type="button" class="bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition text-sm sm:text-base">Logout</button>
    </div>
  </header>
  
  <!-- Navigation -->
  <nav class="bg-gray-800 text-white p-3 sm:p-4">
    <div class="relative">
      <button id="menu-toggle" type="button" class="md:hidden flex items-center px-3 py-2 rounded-lg bg-blue-800 hover:bg-blue-900 transition text-sm sm:text-base w-full text-left" aria-expanded="false">
        <span id="current-tab-name">Dashboard</span>
        <span class="ml-2">â–¼</span>
      </button>
      <div id="menu-items" class="md:flex md:flex-row md:space-x-4 hidden md:block bg-gray-800 md:bg-transparent">
        <button id="dashboard-tab" type="button" class="px-3 py-2 rounded-lg bg-blue-800 hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Dashboard</button>
        <button id="transactions-tab" type="button" class="px-3 py-2 rounded-lg hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Transactions</button>
        <button id="budgets-tab" type="button" class="px-3 py-2 rounded-lg hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Budgets</button>
        <button id="categories-tab" type="button" class="px-3 py-2 rounded-lg hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Categories</button>
        <button id="child-accounts-tab" type="button" class="px-3 py-2 rounded-lg hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Child Accounts</button>
        <button id="profile-tab" type="button" class="px-3 py-2 rounded-lg hover:bg-blue-900 transition text-sm sm:text-base block md:inline-block w-full md:w-auto text-left md:text-center">Profile</button>
      </div>
    </div>
  </nav>
  
  <!-- Main content areas - Will be populated dynamically -->
  <main class="p-4 sm:p-6">
    <div id="swipeable-tabs" class="relative w-full overflow-x-hidden">
      <!-- Content sections will be lazy-loaded here -->
      <div id="dashboard-section" class="space-y-4 sm:space-y-6"></div>
      <div id="transactions-section" class="hidden space-y-4 sm:space-y-6"></div>
      <div id="budgets-section" class="hidden space-y-4 sm:space-y-6"></div>
      <div id="categories-section" class="hidden space-y-4 sm:space-y-6"></div>
      <div id="child-accounts-section" class="hidden space-y-4 sm:space-y-6"></div>
      <div id="profile-section" class="hidden space-y-4 sm:space-y-6"></div>
    </div>
  </main>
</div>

<!-- Modal containers - Will be populated when needed -->
<div id="add-category-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"></div>
<div id="add-budget-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"></div>
<div id="delete-confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center"></div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</body>
</html>
